# Example configuration addition for using GitHub OAuth2 with Pelican
#
# GitHub uses OAuth2 (not OIDC), so you need to explicitly configure
# the endpoints and claim names. This example shows how to set up
# Pelican to authenticate users via GitHub.
#
# Prerequisites:
# 1. Create a GitHub OAuth App at https://github.com/settings/developers
# 2. Set the callback URL to: https://your-server.example.com/api/v1.0/auth/oauth/callback
# 3. Note your Client ID and Client Secret

OIDC:
  # Set the issuer to GitHub (used as fallback for issuer claim)
  Issuer: https://github.com

  # Explicitly configure OAuth2 endpoints (GitHub doesn't support OIDC discovery)
  AuthorizationEndpoint: https://github.com/login/oauth/authorize
  TokenEndpoint: https://github.com/login/oauth/access_token
  UserInfoEndpoint: https://api.github.com/user
  # GitHub supports device auth; this endpoint is required for `Origin.EnableIssuer: true`
  DeviceAuthEndpoint: https://github.com/login/device/code

  # Your GitHub OAuth App credentials
  ClientID: your-github-client-id
  ClientSecretFile: /path/to/client-secret-file

  # GitHub-specific scopes (adjust as needed)
  Scopes:
    - user
    - read:org

  # In dev (containers/tunnels), set this to the hostname the OAuth provider will redirect to (e.g., localhost:port)
  ClientRedirectHostname: <hostname-the-provider-uses-for-callback>

Issuer:
  # Configure which claims to use from GitHub's user info response
  # GitHub returns "login" for username instead of the OIDC standard "sub"
  OIDCAuthenticationUserClaim: login

  # GitHub returns "id" (numeric) instead of the OIDC standard "sub"
  OIDCSubjectClaim: id

  # GitHub doesn't return an "iss" claim, so this setting tells Pelican
  # to fall back to OIDC.Issuer (configured above)
  OIDCIssuerClaim: iss

  # Use GitHub organization membership as groups
  # Requires the "read:org" scope (configured above)
  GroupSource: github

  # Optional: Require users to be a member of at least one of these GitHub orgs
  # If not specified, any authenticated GitHub user can access the server
  GroupRequirements:
    - my-github-org
    - another-allowed-org

  # Define authorization based on GitHub organization membership
  # This example grants read access to members of specific organizations
  AuthorizationTemplates:
    - actions: ["read", "create", "modify"]
      prefix: /projects/foo
      groups: ["my-github-org"]
      # Members of "my-github-org" can read/create/modify objects in /projects/foo


Server:
  ExternalWebUrl: https://your-server.example.com
  # If you want to have the admin access to web UI after logging in via GitHub, set:
  UIAdminUsers: ["<YOUR-GITHUB-USERNAME>"]

Origin:
  EnableIssuer: true
  EnableOIDC: true
