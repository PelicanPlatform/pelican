---
name: Run Tests (macOS) [on schedule]

on:
  schedule:
    - cron: "0 7 * * *"  # at 07:00 every day
  workflow_dispatch:

jobs:
  run-tests:
    name: Test
    uses: ./.github/workflows/test-macos.yml

  analyze-runs:
    name: Analyze Runs
    if: always()
    needs: [run-tests]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Download artifacts
        env:
          GH_TOKEN: ${{ github.token }}
        run: .github/scripts/download_junit_artifacts.sh "Run Tests (macOS) [on schedule]"

      - name: Analyze test results
        run: |
          python3 .github/scripts/analyze_junit_results.py
          cat test-failure-analysis.txt >> $GITHUB_STEP_SUMMARY
